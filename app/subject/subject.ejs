<html>
  <head>
    <title><%= subject.name %></title>
    <style src="./subject.scss"></style>
    <script src="./polyfill.js"></script>
    <script src="./subject.js"></script>
    <link href="/foundation-icons/foundation-icons.css" rel="stylesheet"/>
  </head>
  <body>
    <% include ../index/header.ejs %>
    <main class="row">
      <nav>
	<h4>Latin <small>Mrs Cavalier</small></h4>
	<form>
	  <input type="search" placeholder="Search"></input>
	</form>
	<ul>
	  <li class="active"><a href="/<%= subject._id %>">Blog</a></li>
	  <% if(subject.vocab_quizzes.length != 0) { %>
          <li><a>Vocab Quizzes</a></li>
	  <% } %>
	  <li><a>Student Resources</a></li>

	</ul>
	<% if(user.role === "admin" || user.role === "teacher") { %>
	<a href="#newPostForm" id="newPost"><i class="fi-plus"></i> New Blog Post</a>
	<% } %>
      </nav>
      <div>
	<x-slidable id="newPostForm" hidden>
	  <form action="/<%= subject._id %>" method="post">
	    <input name="title" type="text" placeholder="Title" required/>
	    <span id="formattingButtons">
	      <button>B</button>
	      <button>I</button>
	      <button>U</button>
	    </span>
	    <br/>
	    <textarea name="body"></textarea>
	    <span id="buttons">
	      <button type="submit" formaction="/<%= subject._id %>?drafts=true">Save As Draft</button>
	      <button type="submit">Publish</button>
	    </span>
	  </form>
	</x-slidable>

	<% subject.blog.reverse().forEach(function(post) { %>
	<% if(!post.draft || user.role === "admin" || user.role === "teacher") { %>
	<article class="post">

	  <header class="postHeading">
	    <h2>
	      <a href="/<%= subject._id %>/<%= post._id %>"><%= post.title %></a>
	    </h2>
	  </header>

	  <section class="postActions">
	    <% if(user.role === "admin" || user.role === "teacher") { %>
	    <a class="deletePost" title="Remove"><i class="fi-x"></i></a>
	    <a class="editPost" title="Edit"><i class="fi-pencil"></i></a>
	    <% if(post.draft) { %>
	    <a class="publishPost" title="Publish"><i class="fi-check"></i></a>
	    <% } %>
	    <% } %>
	  </section>	   

	  <section class="postMeta">
	    <% if(post.draft) { %>
	    <h6 class="indicatorDraft">Draft</h6>
	    <% } %>
	  </section>

	  <section class="postExcerpt">
	  <%- (full ? post.body.replace("\n", "<br/><br/>") : us.prune(post.body, 450).replace("\n", "<br/><br/>")) %>
	  </section>

	</article>

	<% } %>
	<% }); %>
      </div>
    </main>
  </body>
</html>
