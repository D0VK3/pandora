<!DOCTYPE html>
<html>
  <head>
    <title><%= subject.name %></title>
    <style src="./subject.scss"></style>
    <script src="./polyfill.js"></script>
    <script src="./subject.js"></script>
    <link href="/foundation-icons/foundation-icons.css" rel="stylesheet"/>
  </head>
   <body>
    <% include ../header/header.ejs %>
    <main class="row">
      <nav id="intraSubjectNavigation">
	<h4><%= subject.subject_name %> <small><%= subject.teacher %></small></h4>
	<form>
	  <input type="search" placeholder="Search"></input>
	</form>
	<ul>
	  <li class="active">
	    <a href="/<%= subject._id %>">
	      Blog 
	    </a>
	    <% if(user.role === "admin" || user.role === "teacher") { %>
	    <a href="/<%= subject._id %>/nova" cite="#newPostForm" title="New Blog Post"><i class="fi-plus"></i></a>
	    <% } %>
	    <a href="/<%= subject._id %>/feed" title="Get RSS Feed"><i class="fi-rss"></i></a>
	  </li>
	  <% if(subject.vocab_quizzes.length != 0) { %>
          <li><a href="/<%= subject._id %>/vocab_quizzes">Vocab Quizzes</a></li>
	  <% } %>
	  <li><a>Student Resources</a></li>
	</ul>

      </nav>
      <div>
	<% if(locals.showNewPostForm) { %>
	<x-slidable id="newPostForm">
	  <% } else { %>
	<x-slidable id="newPostForm" class="jsmore" hidden>
	  <% } %>
	  <form action="/<%= subject._id %>" method="post">
	    <input name="title" type="text" placeholder="Title" required/>
	    <span id="formattingButtons">
	      <button>B</button>
	      <button>I</button>
	      <button>U</button>
	    </span>
	    <br/>
	    <x-richtexteditor class="jsmore" for="#content"></x-richtexteditor>
	    <textarea name="body" class="jsless" id="content"></textarea>
	    <span id="buttons">
	      <button type="submit" formaction="/<%= subject._id %>?drafts=true">Save As Draft</button>
	      <button type="submit">Publish</button>
	    </span>
	  </form>
	</x-slidable>

	<% subject.blog.reverse().forEach(function(post) { %>
	<% if(!post.draft || user.role === "admin" || user.role === "teacher") { %>
	<article class="post">

	  <header class="postHeading">
	    <h2>
	      <a href="/<%= subject._id %>/<%= post._id %>"><%= post.title %></a>
	    </h2>
	  </header>

	  <section class="postActions">
	    <% if(user.role === "admin" || user.role === "teacher") { %>
	    <form action="/<%= subject._id %>/<%= post._id %>" method="post">
	      <input type="hidden" name="_method" value="delete"/>
	      <button class="deletePost" title="Remove" type="submit">
		<i class="fi-x"></i>
	      </button>
	    </form>
	    <button class="editPost" title="Edit"><i class="fi-pencil"></i></button>
	    <% if(post.draft) { %>
	    <button class="publishPost" title="Publish"><i class="fi-check"></i></button>
	    <% } %>
	    <% } %>
	  </section>	   

	  <section class="postMeta">
	    <% if(post.draft) { %>
	    <h6 class="indicatorDraft">Draft</h6>
	    <% } else {  %>
	    <h6>Published on <%= post.date %></h6>
	    <% } %>
	  </section>

	  <section class="postExcerpt">
	  <%- (full ? post.body.replace("\n", "<br/><br/>") : us.prune(post.body, 450).replace("\n", "<br/><br/>")) %>
	  </section>

	</article>

	<% } %>
	<% }); %>
      </div>
    </main>
  </body>
</html>
