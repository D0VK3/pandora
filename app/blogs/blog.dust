<!DOCTYPE html>
<html>
  <head>
    <title>{subject.title}</title>
    <style src="app/subjects/subject.scss"></style>
    <style src="app/blogs/blog.scss"></style>
    <style src="app/header/head.scss"></style>
    <script src="app/subjects/polyfill.js"></script>
    <script src="components/x-slidable.js"></script>
    <script src="components/x-richtexteditor.js"></script>
    <script src="components/x-snowfall.js"></script>
    <script src="components/x-deletable.js"></script>
    <script src="components/x-bubble.js"></script>
    <link href="/foundation-icons/foundation-icons.css" rel="stylesheet"/>
    {>"app/header/global.dust"/}
  </head>
  <body>
    <x-snowfall count="800">
      {>"app/header/head.dust"/}
      {>"app/subjects/nav.dust" active="blog"/}
      <main>
	<div id="action-bar">
	  <a href="/subjects/{subject._id}?nova=true" cite="#newPostForm">New Post <i class="fi-plus"></i></a>
	  <button>New Image<i class="fi-plus"></i></button>
	  <a href="/subjects/{subject._id}/feed" id="rss-link">RSS <i class="fi-rss"></i></a>
	</div>

	{@ne key=user.role value="student"}
	  <x-slidable id="newPostForm" {^nova}class="jsmore" hidden{/nova}>
	    <form action="/subjects/{subject._id}" method="post">
	      <input name="title" type="text" placeholder="Title" required/>
	      <div class="toolbar jsmore">
		<ul>
		  <button exec="bold"><i class="fi-bold"></i></button>
		  <button exec="italic"><i class="fi-italic"></i></button>
		  <button exec="underline"><i class="fi-underline"></i></button>
		</ul>
		<ul>
		  <button exec="insertOrderedList"><i class="fi-list-number"></i></button>
		  <button exec="insertUnorderedList"><i class="fi-list-bullet"></i></button>
		</ul>
		<ul>
		  <button exec="subscript"><i class="fi-subscript"></i></button>
		  <button exec="superscript"><i class="fi-superscript"></i></button>
		</ul>
	      </div>
	      <br/>
	      <x-richtexteditor class="jsmore" for="#content"></x-richtexteditor>
	      <textarea name="body" class="jsless" id="content"></textarea>
	      <span id="buttons">
		<button type="submit" class="publishButton">Publish</button>
		<button type="submit" class="draftButton" formaction="/subjects/{subject._id}?drafts=true">Save As Draft</button>
	      </span>
	    </form>
	  </x-slidable>
	{/ne}

	{#blog}
	  <x-deletable id="post_{$idx}">
	    <article class="post">
	      <header class="postHeading">
	    	<h2><a href="/subjects/{subject._id}/posts/{_id}">{title}</a></h2>
	      </header>

	      <section class="postActions">
	    	{@ne key=user.role value="student"}
	    	  <form action="/subjects/{subject._id}/posts/{_id}" method="post">
	      	    <input type="hidden" name="_method" value="delete"/>
	     	    <button class="deletePost" title="Remove" cite="#post_{$idx}" type="submit"><i class="fi-x"></i></button>
	    	  </form>
	    	  <button class="editPost" title="Edit"><i class="fi-pencil"></i></button>
	    	  {?draft}
	    	    <button class="publishPost" title="Publish"><i class="fi-check"></i></button>
	   	  {/draft}
	    	{/ne}
	      </section>	   

	      <section class="postMeta">
	    	{?draft}
	    	  <h6 class="indicatorDraft">Draft</h6>
	    	{:else}
	    	  <h6>Published on {date}</h6>
	    	{/draft}
	      </section>

	      <section class="postExcerpt">
	  	{body|s}
	      </section>
	    </article>
	  </x-deletable>
	{/blog}
      </main>
    </x-snowfall>
  </body>
</html>
